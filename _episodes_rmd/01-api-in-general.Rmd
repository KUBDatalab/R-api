---
title: "What is an API?"
teaching: 30
exercises: 15
output: 
  html_document:
    df_print: paged
objectives:
- Understand what an API do
- Connect to Statistics Denmark, and extract data
- Create a list of lists to control the variables to be extracted
keypoints: 
- Getting data from an API is equivalent to requesting a webpage
- POST requests to servers put specific demands on how we request data
source: Rmd
questions:
- What is an API?
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include = F, echo=F}
source("../bin/chunk-options.R")
knitr_fig_path("02-")
source("../bin/download_data.R")
library(remotes)
remotes::install_github("cran/danstat")
library(danstat)
library(tidyverse)
```

Please note: These pages are autogenerated. Some of the API-calls may
fail during that process. We are figuring out what to do about it, but
please excuse us for any red errors on the pages for the time being.

## What is an API?

An API is an Application Programming Interface. It is a way of making
applications, in our case an R-script, able to communicate with another
application, here the Statistics Denmark databases.

Talking about APIs, we talk about several different things. It can be
quite confusing, but dont worry!

What we want to be able to do, is to let our own application, our
R-script, send a command to a remote application, the databases of
Statistics Denmark, in order to retrieve specific data.

This is equivalent to requesting a page from a webserver.

The HTTP protocol can be visualized like this:
```{r http-structure, echo = FALSE, fig.show = "hold", out.width = "100%", fig.alt = " "}

knitr::include_graphics("../fig/http-structure.png")
```


-   When we type in an URL in our browser, it translates that URL to a
    HTTP-request.

-   The browser sends that HTTP-request to a webserver. The request
    contains information about the page we need, but in the "header" of
    the request, there is a lot of other information. The version of
    browser we are using and cookies to just mention two.

-   The webserver interpret the request, and retrieves the data.

-   After that, the webserver sends both the status of the request
    (hopefully 200 - which is short for "everything is OK"), and the
    data.

-   The browser receives the data, and displays it as a webpage.

When we are working with APIs we cut out the user. We have a script that
needs some data. We write code that defines, and then send a request til
a server, specifying which data we need. The server extracts the needed
data, and returns it to the script.

So - how do we do that?

Looking closer at the illustration above, we can see that we send a 
request to the server. That request contains several parts.

The request line. That contains the method we are using to 
communicate with the server, the adress and path of the server, and the
information about the version of HTTP we are using to communicate with the
server.

The header. Headers are meta information about our request. It contains 
information about who we are, the type of browser we are using and much more.

The body. This is really the message that we are sending to the server. Where
the request line tells our computer where to we are sending our request, and the
header provides information about the request, the body is the actual message 
we are sending to the server.


The trick is now to make the API understand what data we would like to get back from it.

Two main types of requests are used when communicating with APIs, and they
primarily concerns how we tell the API what data we would like.

In a GET request, we encode what we would like returned in the URL. 
You probably know that way already. 

The URL "https://www.amazon.de/s?k=cthulhu" is asking the amazon.de server
to search (s?) for the word cthulhu. What we are searching for, is placed 
directly in the URL.

In a POST request, that information is stored in the body of the request.


Almost all APIs use one or both of these methods.

The GET method is intuitively easy to understand, and it is relatively easy to 
edit the URL to search for something else. On the other hand there are limitations
to the length of what we are searching for.

The POST method allow us to search for arbitrarily many parameters, and can handle
many different data types, whereas GET can only handle strings. The POST method
is also more secure, because the body can be encrypted during transport from 
our computer to the server. This is also the method we need to use should the
API require a login.



https://www.guru99.com/difference-get-post-http.html#difference-between-a-get-and-post har 
gode illustrationer.

